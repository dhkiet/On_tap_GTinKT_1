<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>√în t·∫≠p GTinKT ‚Äî Mobile</title>
  <script>
    // ====== D·ªÆ LI·ªÜU C√ÇU H·ªéI ======
    const QUESTIONS_ORIGINAL = [{"id": 1, "text": "T√≠nh gi·ªõi h·∫°n sau: \\(L=\\lim_{x\\to 0}\\frac{e^{2x}-1}{\\sin(3x)}\\).", "choices": ["\\(\\frac{2}{3}\\)", "\\(2\\)", "\\(\\frac{1}{3}\\)", "\\(\\frac{3}{2}\\)"], "correct": null}, {"id": 2, "text": "Cho h√†m s·ªë \\(y=\\ln(\\sqrt{x^2+1})\\). T√≠nh ƒë·∫°o h√†m \\(y'\\).", "choices": ["\\(y'=\\frac{x}{x^2+1}\\)", "\\(y'=\\frac{x}{\\sqrt{x^2+1}}\\)", "\\(y'=\\frac{2x}{\\sqrt{x^2+1}}\\)", "\\(y'=\\frac{1}{2(x^2+1)}\\)"], "correct": null}, {"id": 3, "text": "T√≠nh vi ph√¢n c·∫•p m·ªôt \\(dy\\) c·ªßa h√†m s·ªë \\(y=x^3-4x+5\\).", "choices": ["\\(dy=3x^2dx\\)", "\\(dy=(3x^2-4)\\)", "\\(dy=(3x^2-4)dx\\)", "\\(dy=(3x^2+4x)dx\\)"], "correct": null}, {"id": 4, "text": "M·ªôt c√¥ng ty c√≥ h√†m t·ªïng chi ph√≠ \\(C(Q)=Q^3-6Q^2+15Q+20\\) (ngh√¨n ƒë√¥). Chi ph√≠ c·∫≠n bi√™n \\(MC\\) khi \\(Q=4\\) l√† bao nhi√™u?", "choices": ["\\(MC(4)=35\\) ngh√¨n ƒë√¥", "\\(MC(4)=15\\) ngh√¨n ƒë√¥", "\\(MC(4)=25\\) ngh√¨n ƒë√¥", "\\(MC(4)=40\\) ngh√¨n ƒë√¥"], "correct": null}, {"id": 5, "text": "T√≠nh t√≠ch ph√¢n b·∫•t ƒë·ªãnh: \\(I=\\int x e^{x^2}\\,dx\\).", "choices": ["\\(I=x e^{x^2}-\\int e^{x^2}\\,dx+C\\)", "\\(I=2x^2e^{x^2}+C\\)", "\\(I=e^{x^2}+C\\)", "\\(I=\\frac12 e^{x^2}+C\\)"], "correct": null}, {"id": 6, "text": "Cho t√≠ch ph√¢n suy r·ªông \\(\\int_{1}^{+\\infty}\\frac{x\\,dx}{x^2+\\sin^2 x}\\) (1) v√† \\(\\int_{e}^{+\\infty}\\frac{dx}{x\\ln^2 x}\\) (2). Ph√°t bi·ªÉu n√†o ƒë√∫ng?", "choices": ["T√≠ch ph√¢n (1) v√† (2) h·ªôi t·ª•", "T√≠ch ph√¢n (1) h·ªôi t·ª• v√† (2) ph√¢n k·ª≥", "T√≠ch ph√¢n (1) ph√¢n k·ª≥ v√† (2) h·ªôi t·ª•", "T√≠ch ph√¢n (1) v√† (2) ph√¢n k·ª≥"], "correct": null}, {"id": 7, "text": "H√†m c·∫ßu \\(Q(p)=200-4p\\). N·∫øu gi√° c√¢n b·∫±ng \\(p_0=10\\), th·∫∑ng d∆∞ ti√™u d√πng (CS) b·∫±ng bao nhi√™u?", "choices": ["\\(CS=3200\\)", "\\(CS=800\\)", "\\(CS=1600\\)", "\\(CS=200\\)"], "correct": null}, {"id": 8, "text": "M√¥ h√¨nh Harrod‚ÄìDomar: \\(\\frac{dK}{dt}=sY-\\delta K\\). N·∫øu \\(Y=5K\\), \\(s=0.2\\), \\(\\delta=0.1\\). T√¨m t·ªëc ƒë·ªô tƒÉng tr∆∞·ªüng v·ªën \\(\\frac{1}{K}\\frac{dK}{dt}\\) trong tr·∫°ng th√°i c√¢n b·∫±ng d√†i h·∫°n (n·∫øu c√≥).", "choices": ["\\(1.0\\)", "\\(0.1\\)", "\\(0.5\\)", "\\(0.9\\)"], "correct": null}, {"id": 9, "text": "Gi·∫£ s·ª≠ \\(Q_d=100-2P\\), \\(Q_s=-20+4P\\). T·ªëc ƒë·ªô thay ƒë·ªïi gi√°: \\(\\frac{dP}{dt}=0.5(Q_d-Q_s)\\). H√£y t√¨m ph∆∞∆°ng tr√¨nh vi ph√¢n cho gi√° \\(P(t)\\).", "choices": ["\\(\\frac{dP}{dt}=6P-120\\)", "\\(\\frac{dP}{dt}=120-6P\\)", "\\(\\frac{dP}{dt}=60-3P\\)", "\\(\\frac{dP}{dt}=3P-60\\)"], "correct": null}, {"id": 10, "text": "Nghi·ªám t·ªïng qu√°t c·ªßa ph∆∞∆°ng tr√¨nh vi ph√¢n \\(y' + \\frac{y}{x+2}=3x\\) l√†:", "choices": ["\\(y=\\frac{x^3+3x^2+C}{x+2}\\)", "\\(y=\\frac{C}{x+2}\\)", "\\(y=x+1+\\frac{C}{x+2}\\)", "\\(y=x^2+\\frac{C}{x+2}\\)"], "correct": null}, {"id": 11, "text": "Cho h√†m t·ªïng chi ph√≠ \\(C(Q)=Q^2+10Q+500\\). T√≠nh chi ph√≠ bi√™n \\(MC\\) t·∫°i \\(Q=20\\).", "choices": ["\\(MC=30\\)", "\\(MC=40\\)", "\\(MC=50\\)", "\\(MC=1100\\)"], "correct": null}, {"id": 12, "text": "M·ªôt doanh nghi·ªáp c√≥ h√†m c·∫ßu \\(P=100-2Q\\). Doanh thu bi√™n \\(MR\\) t·∫°i \\(Q=10\\) l√† bao nhi√™u?", "choices": ["\\(MR=60\\)", "\\(MR=80\\)", "\\(MR=100\\)", "\\(MC=40\\)"], "correct": null}, {"id": 13, "text": "Bi·∫øt \\(MC(x)=6x+20\\) v√† chi ph√≠ c·ªë ƒë·ªãnh l√† 1000. T√¨m h√†m t·ªïng chi ph√≠ \\(C(x)\\).", "choices": ["\\(C(x)=3x^2+20x\\)", "\\(C(x)=6x+1020\\)", "\\(C(x)=3x^2+20x+1000\\)", "\\(C(x)=6x^2+20x+1000\\)"], "correct": null}, {"id": 14, "text": "H√†m c·∫ßu \\(P=40-0.5Q\\). N·∫øu gi√° c√¢n b·∫±ng \\(P=30\\), th·∫∑ng d∆∞ ti√™u d√πng (CS) b·∫±ng bao nhi√™u?", "choices": ["\\(CS=200\\)", "\\(CS=50\\)", "\\(CS=400\\)", "\\(CS=100\\)"], "correct": null}, {"id": 15, "text": "Trong m√¥ h√¨nh vƒ© m√¥, n·∫øu \\(MPC=0.8\\), s·ªë nh√¢n chi ti√™u \\(k\\) c·ªßa n·ªÅn kinh t·∫ø l√†:", "choices": ["\\(k=1.25\\)", "\\(k=0.8\\)", "\\(k=4\\)", "\\(k=5\\)"], "correct": null}, {"id": 16, "text": "Ch√≠nh ph·ªß b∆°m th√™m 100 t·ª∑ v√†o n·ªÅn kinh t·∫ø. Bi·∫øt \\(MPS=0.25\\). T·ªïng m·ª©c gia tƒÉng thu nh·∫≠p qu·ªëc d√¢n theo l√Ω thuy·∫øt s·ªë nh√¢n l√†:", "choices": ["250 t·ª∑", "500 t·ª∑", "400 t·ª∑", "125 t·ª∑"], "correct": null}, {"id": 17, "text": "Gi·∫£i ph∆∞∆°ng tr√¨nh vi ph√¢n \\(2xy\\,dx+dy=0\\). K·∫øt qu·∫£ n√†o ƒë√∫ng?", "choices": ["\\(x^2y+y=C\\)", "\\(xy^2+y=C\\)", "\\(2xy+1=C\\)", "\\(x^2+\\ln|y|=C\\)"], "correct": null}, {"id": 18, "text": "T√¨m mi·ªÅn x√°c ƒë·ªãnh \\(D\\) c·ªßa h√†m s·ªë \\(z=\\ln(1-x^2-y^2)\\).", "choices": ["\\(D=\\{(x,y)\\in\\mathbb{R}^2: x^2+y^2<1\\}\\)", "\\(D=\\{(x,y)\\in\\mathbb{R}^2: x^2+y^2>1\\}\\)", "\\(D=\\mathbb{R}^2\\setminus(0,0)\\)", "\\(D=\\{(x,y)\\in\\mathbb{R}^2: x^2+y^2\\le 1\\}\\)"], "correct": null}, {"id": 19, "text": "X√©t gi·ªõi h·∫°n \\(L=\\lim_{(x,y)\\to(0,0)}\\frac{xy}{x^2+y^2}\\). Kh·∫≥ng ƒë·ªãnh n√†o ƒë√∫ng?", "choices": ["\\(L=\\infty\\)", "\\(L=0\\)", "Gi·ªõi h·∫°n kh√¥ng t·ªìn t·∫°i", "\\(L=\\frac12\\)"], "correct": null}, {"id": 20, "text": "M·ªôt DN ƒë·ªôc quy·ªÅn 2 SP v·ªõi s·ªë l∆∞·ª£ng \\(x,y\\). L·ª£i nhu·∫≠n: \\(\\pi(x,y)=-2x^2-y^2+40x+60y-100\\). X√°c ƒë·ªãnh \\((x,y)\\) ƒë·ªÉ l·ª£i nhu·∫≠n t·ªëi ƒëa.", "choices": ["\\(x=10,\\,y=30\\)", "\\(x=20,\\,y=60\\)", "\\(x=10,\\,y=15\\)", "\\(x=30,\\,y=10\\)"], "correct": null}, {"id": 21, "text": "Chi ph√≠ s·∫£n xu·∫•t ph·ª• thu·ªôc \\(K,L\\): \\(C=2K^2+L^2-80K-40L+5000\\). ƒê·ªÉ chi ph√≠ t·ªëi thi·ªÉu, c·∫ßn \\(K,L\\) b·∫±ng bao nhi√™u?", "choices": ["\\(K=40,\\,L=20\\)", "\\(K=20,\\,L=40\\)", "\\(K=20,\\,L=20\\)", "\\(K=80,\\,L=40\\)"], "correct": null}, {"id": 22, "text": "Cho hai chu·ªói s·ªë \\(\\sum_{n=1}^{+\\infty}\\left(1-\\cos\\frac{1}{n}\\right)\\) (1) v√† \\(\\sum_{n=1}^{+\\infty}\\frac{2}{n+n^2}\\) (2). Kh·∫≥ng ƒë·ªãnh n√†o ƒë√∫ng?", "choices": ["Chu·ªói (1) h·ªôi t·ª•, chu·ªói (2) ph√¢n k·ª≥", "Chu·ªói (1) h·ªôi t·ª•, chu·ªói (2) h·ªôi t·ª•", "Chu·ªói (1) ph√¢n k·ª≥, chu·ªói (2) ph√¢n k·ª≥", "Chu·ªói (1) ph√¢n k·ª≥, chu·ªói (2) h·ªôi t·ª•"], "correct": null}, {"id": 23, "text": "T√≠nh t·ªïng c·ªßa chu·ªói \\(\\sum_{n=1}^{+\\infty}\\frac{1}{n(n+1)}\\).", "choices": ["Ph√¢n k·ª≥", "\\(2\\)", "\\(1\\)", "\\(0\\)"], "correct": null}, {"id": 24, "text": "M·ªói ƒë·∫ßu th√°ng g·ª≠i 2.000.000ƒë, l√£i k√©p 0,7%/th√°ng. Sau 24 th√°ng nh·∫≠n ƒë∆∞·ª£c (l√†m tr√≤n ngh√¨n ƒë·ªìng) l√†:", "choices": ["51.218.000", "51.578.000", "48.000.000", "52.000.000"], "correct": null}, {"id": 25, "text": "G·ª≠i 500.000.000ƒë l√£i k√©p k·ª≥ h·∫°n 1 nƒÉm, l√£i su·∫•t 8,5%/nƒÉm. Sau 7 nƒÉm nh·∫≠n c·∫£ g·ªëc l·∫´n l√£i (l√†m tr√≤n ngh√¨n ƒë·ªìng) l√†:", "choices": ["893.813.0000 ƒë·ªìng", "850.000.000 ƒë·ªìng", "885.071.124 ƒë·ªìng", "920.000.000 ƒë·ªìng"], "correct": null}];

    // ====== C·∫§U H√åNH ======
    // Th·ªùi gian l√†m b√†i m·∫∑c ƒë·ªãnh (ph√∫t). C√≥ th·ªÉ ƒë·ªïi b·∫±ng URL: ?t=60
    const DEFAULT_MINUTES = 60;

    // N·∫øu mu·ªën CH·∫§M ƒêI·ªÇM, ƒëi·ªÅn ƒë√°p √°n ƒë√∫ng theo TH·ª® T·ª∞ ID g·ªëc (1..25), d·∫°ng 0..3.
    // V√≠ d·ª•: const ANSWER_KEY = {1:0, 2:1, ...};
    const ANSWER_KEY = {"1": 0, "2": 0, "3": 2, "4": 1, "5": 3, "6": 2, "7": 0, "8": 3, "9": 2, "10": 0, "11": 2, "12": 0, "13": 2, "14": 3, "15": 3, "16": 2, "17": 3, "18": 0, "19": 2, "20": 0, "21": 2, "22": 1, "23": 2, "24": 3, "25": 2};
    const SCORE_PER_QUESTION = 0.4;

    // ====== TI·ªÜN √çCH ======
    const $ = (sel) => document.querySelector(sel);

    function shuffle(array) {
      const a = array.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function parseMinutesFromURL() {
      const p = new URLSearchParams(location.search);
      const t = Number(p.get("t"));
      if (Number.isFinite(t) && t > 0 && t <= 300) return Math.floor(t);
      return DEFAULT_MINUTES;
    }

    function formatTime(sec) {
      const m = Math.floor(sec / 60);
      const s = sec % 60;
      return String(m).padStart(2, "0") + ":" + String(s).padStart(2, "0");
    }

    // ====== TR·∫†NG TH√ÅI ======
    let minutes = parseMinutesFromURL();
    let timeLeft = minutes * 60;
    let timer = null;

    // questions: m·∫£ng ƒë√£ tr·ªôn th·ª© t·ª± + tr·ªôn ƒë√°p √°n (k√®m map)
    let questions = [];
    // answers: l∆∞u theo index c·ªßa questions[] -> choiceIndex (0..3)
    let answers = {};
    let flagged = {};
    let currentIndex = 0;
    let submitted = false;

    // Local storage key (m·ªói ƒë·ªÅ 1 key)
    const STORAGE_KEY = "calc_econ_exam_v1";

    function buildShuffledQuestions() {
      const base = QUESTIONS_ORIGINAL.map(q => ({
        id: q.id,
        text: q.text,
        choices: q.choices.slice()
      }));

      const order = shuffle(base);
      const withChoiceShuffle = order.map(q => {
        const choiceObjs = q.choices.map((txt, idx) => ({ txt, originalIdx: idx }));
        const shuffled = shuffle(choiceObjs);
        return {
          id: q.id,
          text: q.text,
          choices: shuffled.map(x => x.txt),
          mapNewToOld: shuffled.map(x => x.originalIdx)
        };
      });
      return withChoiceShuffle;
    }

    function saveState() {
      const state = {
        minutes,
        timeLeft,
        questions,
        answers,
        flagged,
        currentIndex,
        submitted,
        ts: Date.now()
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return false;
        const state = JSON.parse(raw);
        if (!state || !Array.isArray(state.questions)) return false;

        minutes = state.minutes ?? minutes;
        timeLeft = state.timeLeft ?? timeLeft;
        questions = state.questions;
        answers = state.answers ?? {};
        flagged = state.flagged ?? {};
        currentIndex = state.currentIndex ?? 0;
        submitted = !!state.submitted;
        return true;
      } catch (e) {
        return false;
      }
    }

    function resetAll() {
      localStorage.removeItem(STORAGE_KEY);
      minutes = parseMinutesFromURL();
      timeLeft = minutes * 60;
      questions = buildShuffledQuestions();
      answers = {};
      flagged = {};
      currentIndex = 0;
      submitted = false;
      renderAll();
      startTimer();
      saveState();
    }

    // ====== RENDER ======
    function renderHeader() {
      $("#meta").textContent = `ƒê·ªÅ g·ªìm 25 c√¢u ‚Ä¢ Th·ªùi gian: ${minutes} ph√∫t`;
      $("#timer").textContent = formatTime(timeLeft);
      $("#progress").textContent = `${currentIndex + 1} / ${questions.length}`;
      const answeredCount = Object.keys(answers).length;
      $("#answered").textContent = `ƒê√£ ch·ªçn: ${answeredCount}/${questions.length}`;
    }

    function renderQuestion() {
      const q = questions[currentIndex];
      $("#qId").textContent = `C√¢u ${currentIndex + 1}`;
      $("#qText").innerHTML = q.text;

      const list = $("#choices");
      list.innerHTML = "";

      const selected = answers[currentIndex];
      q.choices.forEach((choiceText, i) => {
        const btn = document.createElement("button");
        btn.className = "choice";
        btn.type = "button";
        btn.innerHTML = `<span class="badge">${String.fromCharCode(65 + i)}</span>
                         <span class="ct">${choiceText}</span>`;
        if (selected === i) btn.classList.add("selected");
        btn.addEventListener("click", () => {
          if (submitted) return;
          answers[currentIndex] = i;
          saveState();
          renderQuestion();
          renderHeader();
          typesetMath();
        });
        list.appendChild(btn);
      });

      // Flag
      const isFlagged = !!flagged[currentIndex];
      $("#flagBtn").classList.toggle("on", isFlagged);
      $("#flagBtn").textContent = isFlagged ? "‚òÖ ƒê√£ ƒë√°nh d·∫•u" : "‚òÜ ƒê√°nh d·∫•u";

      // Nav buttons
      $("#prevBtn").disabled = currentIndex === 0 || submitted;
      $("#nextBtn").disabled = currentIndex === questions.length - 1 || submitted;

      $("#jumpInfo").textContent = isFlagged ? "C√¢u n√†y ƒëang ƒë∆∞·ª£c ƒë√°nh d·∫•u ƒë·ªÉ xem l·∫°i." : "";
    }

    function renderGrid() {
      const grid = $("#grid");
      grid.innerHTML = "";
      questions.forEach((_, i) => {
        const b = document.createElement("button");
        b.type = "button";
        b.className = "cell";
        b.textContent = String(i + 1);
        if (i === currentIndex) b.classList.add("active");
        if (answers[i] !== undefined) b.classList.add("answered");
        if (flagged[i]) b.classList.add("flagged");
        b.addEventListener("click", () => {
          if (submitted) return;
          currentIndex = i;
          saveState();
          renderAll();
        });
        grid.appendChild(b);
      });
    }

    function renderSubmitPanel() {
      $("#submitBtn").disabled = submitted;
      $("#resetBtn").disabled = false;
      $("#reviewBtn").disabled = submitted;
      $("#submitBtn").textContent = submitted ? "ƒê√£ n·ªôp b√†i" : "N·ªôp b√†i";
    }

    function renderResult() {
      const box = $("#result");
      box.innerHTML = "";
      if (!submitted) {
        box.classList.add("hidden");
        return;
      }
      box.classList.remove("hidden");

      const total = questions.length;
      const answeredCount = Object.keys(answers).length;

      let scoreBlock = "";
      if (ANSWER_KEY) {
        let correct = 0;
        for (let i = 0; i < total; i++) {
          const q = questions[i];
          const chosen = answers[i];
          if (chosen === undefined) continue;
          const chosenOriginal = q.mapNewToOld[chosen];
          if (ANSWER_KEY[q.id] === chosenOriginal) correct++;
        }
        const score = (correct * SCORE_PER_QUESTION);
        scoreBlock = `<div class="score">S·ªë c√¢u ƒë√∫ng: <b>${correct}/${total}</b> ‚Ä¢ ƒêi·ªÉm: <b>${score.toFixed(1)}/10</b></div>`;
      } else {
        scoreBlock = `<div class="score muted">Ch∆∞a ch·∫•m ƒëi·ªÉm v√¨ ch∆∞a c√≥ ƒë√°p √°n.</div>`;
      }

      const rows = [];
      for (let i = 0; i < total; i++) {
        const chosen = answers[i];
        const chosenLabel = (chosen === undefined) ? "‚Äî" : String.fromCharCode(65 + chosen);
        rows.push(`<div class="sumrow"><span>C√¢u ${i+1}</span><span class="pill">${chosenLabel}</span></div>`);
      }

      box.innerHTML = `
        <h3>K·∫øt qu·∫£ / T√≥m t·∫Øt b√†i l√†m</h3>
        <div class="meta2">ƒê√£ ch·ªçn: <b>${answeredCount}/${total}</b> ‚Ä¢ Th·ªùi gian c√≤n l·∫°i khi n·ªôp: <b>${formatTime(timeLeft)}</b></div>
        ${scoreBlock}
        <div class="sum">${rows.join("")}</div>
      `;
    }

    function typesetMath() {
      if (window.MathJax && window.MathJax.typesetPromise) {
        window.MathJax.typesetPromise();
      }
    }

    function renderAll() {
      renderHeader();
      renderQuestion();
      renderGrid();
      renderSubmitPanel();
      renderResult();
      typesetMath();
    }

    // ====== TIMER ======
    function startTimer() {
      stopTimer();
      $("#timer").textContent = formatTime(timeLeft);
      timer = setInterval(() => {
        if (submitted) return;
        timeLeft--;
        if (timeLeft <= 0) {
          timeLeft = 0;
          $("#timer").textContent = formatTime(timeLeft);
          submitExam(true);
          return;
        }
        $("#timer").textContent = formatTime(timeLeft);
        if (timeLeft % 5 === 0) saveState();
      }, 1000);
    }

    function stopTimer() {
      if (timer) clearInterval(timer);
      timer = null;
    }

    // ====== SUBMIT ======
    function submitExam(auto=false) {
      if (submitted) return;
      submitted = true;
      stopTimer();
      saveState();

      $("#toast").textContent = auto ? "H·∫øt gi·ªù ‚Äî b√†i ƒë√£ ƒë∆∞·ª£c n·ªôp t·ª± ƒë·ªông." : "ƒê√£ n·ªôp b√†i.";
      $("#toast").classList.remove("hidden");
      setTimeout(() => $("#toast").classList.add("hidden"), 2500);

      renderAll();
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    // ====== INIT ======
    window.addEventListener("DOMContentLoaded", () => {
      const hasState = loadState();
      if (!hasState) {
        questions = buildShuffledQuestions();
        saveState();
      }
      renderAll();
      if (!submitted) startTimer();

      $("#prevBtn").addEventListener("click", () => {
        if (submitted) return;
        if (currentIndex > 0) {
          currentIndex--;
          saveState();
          renderAll();
        }
      });

      $("#nextBtn").addEventListener("click", () => {
        if (submitted) return;
        if (currentIndex < questions.length - 1) {
          currentIndex++;
          saveState();
          renderAll();
        }
      });

      $("#flagBtn").addEventListener("click", () => {
        if (submitted) return;
        flagged[currentIndex] = !flagged[currentIndex];
        saveState();
        renderAll();
      });

      $("#reviewBtn").addEventListener("click", () => {
        if (submitted) return;
        for (let i = 0; i < questions.length; i++) {
          if (answers[i] === undefined) {
            currentIndex = i;
            saveState();
            renderAll();
            return;
          }
        }
        $("#toast").textContent = "B·∫°n ƒë√£ ch·ªçn ƒë√°p √°n cho t·∫•t c·∫£ c√¢u.";
        $("#toast").classList.remove("hidden");
        setTimeout(() => $("#toast").classList.add("hidden"), 1800);
      });

      $("#submitBtn").addEventListener("click", () => {
        if (submitted) return;
        const unanswered = questions.length - Object.keys(answers).length;
        if (unanswered > 0) {
          const ok = confirm(`C√≤n ${unanswered} c√¢u ch∆∞a ch·ªçn. V·∫´n n·ªôp b√†i?`);
          if (!ok) return;
        } else {
          const ok = confirm("N·ªôp b√†i ngay?");
          if (!ok) return;
        }
        submitExam(false);
      });

      $("#resetBtn").addEventListener("click", () => {
        const ok = confirm("L√†m l·∫°i t·ª´ ƒë·∫ßu? (S·∫Ω tr·ªôn l·∫°i ƒë·ªÅ v√† x√≥a b√†i ƒëang l√†m)");
        if (!ok) return;
        resetAll();
      });
    });
  </script>

  <!-- MathJax -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [["\\(","\\)"], ["$","$"]],
        displayMath: [["\\[","\\]"], ["$$","$$"]]
      },
      options: {
        skipHtmlTags: ["script","noscript","style","textarea","pre","code"]
      }
    };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <style>
    :root {
      --bg: #0b0f17;
      --card: #111827;
      --muted: #9ca3af;
      --text: #e5e7eb;
      --accent: #22c55e;
      --accent2: #60a5fa;
      --danger: #ef4444;
      --border: rgba(255,255,255,0.08);
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: linear-gradient(180deg, #070a10, var(--bg));
      color: var(--text);
      -webkit-tap-highlight-color: transparent;
    }
    .wrap {
      max-width: 900px;
      margin: 0 auto;
      padding: 14px 12px 22px;
      padding-bottom: calc(22px + env(safe-area-inset-bottom));
    }
    header {
      position: sticky;
      top: 0;
      z-index: 10;
      background: rgba(11,15,23,0.8);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      padding: 10px 12px;
      margin: -14px -12px 12px;
    }
    .row {
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    .title {
      font-size: 16px;
      font-weight: 800;
      letter-spacing: 0.2px;
    }
    .meta {
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
    }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border: 1px solid var(--border);
      border-radius: 999px;
      background: rgba(255,255,255,0.04);
      font-size: 12px;
      color: var(--text);
      user-select: none;
    }
    .pill b { font-weight: 800; }
    .timer {
      border-color: rgba(239,68,68,0.35);
      background: rgba(239,68,68,0.08);
    }
    .card {
      background: rgba(17,24,39,0.9);
      border: 1px solid var(--border);
      border-radius: 18px;
      box-shadow: var(--shadow);
      padding: 14px;
    }
    .qhead {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 10px;
    }
    .qid {
      font-size: 14px;
      font-weight: 900;
    }
    .qtext {
      margin-top: 10px;
      font-size: 16px;
      line-height: 1.45;
    }
    .choices {
      margin-top: 12px;
      display: grid;
      gap: 10px;
    }
    .choice {
      width: 100%;
      text-align: left;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.03);
      color: var(--text);
      border-radius: 16px;
      padding: 12px 12px;
      display: grid;
      grid-template-columns: 34px 1fr;
      gap: 10px;
      align-items: start;
      font-size: 16px;
      line-height: 1.4;
      cursor: pointer;
    }
    .choice:active { transform: scale(0.99); }
    .choice.selected {
      border-color: rgba(34,197,94,0.65);
      background: rgba(34,197,94,0.10);
    }
    .badge {
      width: 34px;
      height: 34px;
      border-radius: 12px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 900;
      background: rgba(96,165,250,0.14);
      border: 1px solid rgba(96,165,250,0.25);
      color: #dbeafe;
      user-select: none;
    }
    .ct { padding-top: 2px; }

    .nav {
      display: flex;
      gap: 10px;
      margin-top: 12px;
    }
    .btn {
      flex: 1;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.04);
      color: var(--text);
      border-radius: 16px;
      padding: 12px 12px;
      font-size: 15px;
      font-weight: 800;
      cursor: pointer;
    }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .btn.primary {
      background: rgba(34,197,94,0.16);
      border-color: rgba(34,197,94,0.30);
    }
    .btn.warn {
      background: rgba(239,68,68,0.14);
      border-color: rgba(239,68,68,0.30);
    }
    .btn.ghost { background: transparent; }
    .subbar { margin-top: 12px; display: grid; gap: 10px; }
    .mini { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; justify-content: space-between; }
    .grid {
      margin-top: 12px;
      display: grid;
      grid-template-columns: repeat(10, minmax(0, 1fr));
      gap: 8px;
    }
    @media (max-width: 420px) {
      .grid { grid-template-columns: repeat(8, minmax(0, 1fr)); }
    }
    .cell {
      border-radius: 12px;
      padding: 10px 0;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.03);
      color: var(--text);
      font-weight: 800;
      cursor: pointer;
      font-size: 13px;
    }
    .cell.active { outline: 2px solid rgba(96,165,250,0.55); }
    .cell.answered { border-color: rgba(34,197,94,0.55); background: rgba(34,197,94,0.10); }
    .cell.flagged { border-color: rgba(250,204,21,0.65); background: rgba(250,204,21,0.10); }

    .hint { color: var(--muted); font-size: 12px; margin-top: 10px; line-height: 1.35; }
    .muted { color: var(--muted); }
    .jumpInfo { margin-top: 8px; font-size: 12px; color: rgba(250,204,21,0.9); }

    .toast {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 16px;
      background: rgba(17,24,39,0.95);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      box-shadow: var(--shadow);
      z-index: 50;
      font-weight: 700;
      max-width: 92vw;
      text-align: center;
    }
    .hidden { display: none; }

    .result { margin-top: 12px; }
    .result h3 { margin: 0 0 6px; font-size: 16px; }
    .meta2 { color: var(--muted); font-size: 12px; margin-bottom: 10px; }
    .score {
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(96,165,250,0.10);
      margin-bottom: 10px;
      font-size: 14px;
    }
    .score.muted { background: rgba(255,255,255,0.03); color: var(--muted); }
    .sum { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 8px; }
    .sumrow {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.03);
      font-size: 13px;
    }
  </style>
</head>

<body>
  <header>
    <div class="row">
      <div>
        <div class="title"> √în t·∫≠p GTinKT HK1 (2025-2026) - THAM KH·∫¢O 1 </div>
        <div class="meta" id="meta"></div>
      </div>
      <div class="row" style="gap:8px;">
        <div class="pill timer">‚è±Ô∏è <b id="timer">--:--</b></div>
        <div class="pill">üìå <b id="progress">0/0</b></div>
      </div>
    </div>
    <div class="row" style="margin-top:8px;">
      <div class="pill">‚úÖ <span id="answered">ƒê√£ ch·ªçn: 0/0</span></div>
    </div>
  </header>

  <div class="wrap">
    <div class="card">
      <div class="qhead">
        <div class="qid" id="qId">C√¢u 1</div>
        <button class="btn ghost" id="flagBtn" type="button">‚òÜ ƒê√°nh d·∫•u</button>
      </div>
      <div class="qtext" id="qText"></div>

      <div class="choices" id="choices"></div>
      <div class="jumpInfo" id="jumpInfo"></div>

      <div class="nav">
        <button class="btn" id="prevBtn" type="button">‚¨ÖÔ∏è Tr∆∞·ªõc</button>
        <button class="btn" id="nextBtn" type="button">Sau ‚û°Ô∏è</button>
      </div>

      <div class="subbar">
        <div class="mini">
          <button class="btn" id="reviewBtn" type="button">üîé T·ªõi c√¢u ch∆∞a l√†m</button>
          <button class="btn primary" id="submitBtn" type="button">N·ªôp b√†i</button>
        </div>
        <div class="mini">
          <button class="btn warn" id="resetBtn" type="button">üîÅ L√†m l·∫°i (tr·ªôn l·∫°i ƒë·ªÅ)</button>
          <div class="hint">* Khi n·ªôp b√†i (ho·∫∑c h·∫øt gi·ªù), h·ªá th·ªëng kh√≥a ch·ªçn ƒë√°p √°n v√† hi·ªán t√≥m t·∫Øt b√†i l√†m.</div>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:12px;">
      <div class="row">
        <div style="font-weight:900;">B·∫£ng c√¢u h·ªèi</div>
        <div class="muted" style="font-size:12px;">Xanh = ƒë√£ ch·ªçn ‚Ä¢ V√†ng = ƒë√°nh d·∫•u</div>
      </div>
      <div class="grid" id="grid"></div>
      <div class="hint">
        N·∫øu tho√°t tr√¨nh duy·ªát r·ªìi m·ªü l·∫°i, b√†i v·∫´n c√≤n (ch∆∞a n·ªôp).
      </div>
    </div>

    <div class="card result hidden" id="result"></div>

  </div>

  <div class="toast hidden" id="toast"></div>
</body>
</html>
